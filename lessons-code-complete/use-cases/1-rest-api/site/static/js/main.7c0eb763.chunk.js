(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,function(e,t,n){e.exports=n.p+"static/media/deploy-to-netlify.4fdff352.svg"},function(e,t,n){e.exports=n.p+"static/media/logo.726a2e11.svg"},function(e,t,n){e.exports=n.p+"static/media/github.caf7b92e.svg"},,,function(e,t,n){e.exports=n(31)},,,,,,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),l=n(7),c=n.n(l),s=(n(19),n(1)),r=n(2),i=n(4),d=n(3),u=n(5),m=n(12),h=n(11),p=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return(n=Object(i.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).preventEnter=function(e){if(13===e.which)return e.preventDefault(),!!n.htmlEl&&(n.htmlEl.blur(),!1)},n.emitChange=function(e){if(!n.htmlEl)return!1;var t=n.htmlEl.innerHTML;n.props.onChange&&t!==n.lastHtml&&(e.target.value=t,n.props.onChange(e,t)),n.lastHtml=t},n}return Object(u.a)(t,e),Object(r.a)(t,[{key:"shouldComponentUpdate",value:function(e){return!this.htmlEl||e.html!==this.htmlEl.innerHTML&&e.html!==this.props.html||this.props.disabled!==e.disabled}},{key:"componentDidUpdate",value:function(){this.htmlEl&&this.props.html!==this.htmlEl.innerHTML&&(this.htmlEl.innerHTML=this.props.html)}},{key:"render",value:function(){var e=this,t=this.props,n=t.tagName,a=t.html,l=(t.onChange,Object(h.a)(t,["tagName","html","onChange"])),c=n||"div",s=Object(m.a)({},l,{ref:function(t){return e.htmlEl=t},onKeyDown:this.preventEnter,onInput:this.emitChange,onBlur:this.props.onBlur||this.emitChange,contentEditable:!this.props.disabled}),r=this.props.children;return a&&(s.dangerouslySetInnerHTML={__html:a},r=null),o.a.createElement(c,s,r)}}]),t}(o.a.Component),f=(n(21),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(i.a)(this,Object(d.a)(t).call(this,e))).handleClick=function(e){e.preventDefault();var t=e||window.event;if(t.persist(),!n.hasFocused){var a=function(e){var t,n=e.clientX,a=e.clientY;if(document.body.createTextRange)(t=document.body.createTextRange()).moveToPoint(n,a);else if("undefined"!==typeof document.createRange)if("undefined"!==typeof e.rangeParent)(t=document.createRange()).setStart(e.rangeParent,e.rangeOffset),t.collapse(!0);else if(document.caretPositionFromPoint){var o=document.caretPositionFromPoint(n,a);(t=document.createRange()).setStart(o.offsetNode,o.offset),t.collapse(!0)}else document.caretRangeFromPoint&&(t=document.caretRangeFromPoint(n,a));return t}(t);window.setTimeout(function(){!function(e){if(e)if("undefined"!==typeof e.select)e.select();else if("undefined"!==typeof window.getSelection){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}}(a),n.hasFocused=!0},0)}n.setState({disabled:!1})},n.handleClickOutside=function(e){(e||window.event).persist();var t=e.target.value||e.target.innerText;n.setState({disabled:!0},function(){n.hasFocused=!1,n.props.onBlur&&n.props.onBlur(e,t)})},n.state={disabled:!0},n.hasFocused=!1,n}return Object(u.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props,t=e.onChange,n=e.children,a=e.html,l=e.editKey,c=e.tagName,s=a||n;return o.a.createElement(p,{tagName:c,"data-key":l,className:"editable",onClick:this.handleClick,onBlur:this.handleClickOutside,html:s,disabled:this.state.disabled,onChange:t})}}]),t}(o.a.Component));var g=n(8),v=n.n(g),y=n(9),b=n.n(y),E=n(10),w=n.n(E),N=(n(23),function(e){return o.a.createElement("header",{className:"app-header"},o.a.createElement("div",{className:"app-title-wrapper"},o.a.createElement("div",{className:"app-title-wrapper"},o.a.createElement("div",{className:"app-left-nav"},o.a.createElement("img",{src:b.a,className:"app-logo",alt:"logo"}),o.a.createElement("div",{className:"app-title-text"},o.a.createElement("h1",{className:"app-title"},"Netlify + Fauna DB"),o.a.createElement("p",{className:"app-intro"},"Using FaunaDB & Netlify functions")))),o.a.createElement("div",{className:"deploy-button-wrapper"},o.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://app.netlify.com/start/deploy?repository=https://github.com/netlify/netlify-faunadb-example"},o.a.createElement("img",{src:v.a,className:"deploy-button",alt:"deploy to netlify"})),o.a.createElement("div",{className:"view-src"},o.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/netlify/netlify-faunadb-example"},o.a.createElement("img",{className:"github-icon",src:w.a,alt:"view repo on github"}),"View the source Luke")))))}),k=(n(25),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return(n=Object(i.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).handleEscKey=function(e){n.props.showMenu&&27===e.which&&n.props.handleModalClose()},n.handleDelete=function(e){e.preventDefault(),window.confirm("Are you sure you want to clear all completed todos?")&&(console.log("delete"),n.props.handleClearCompleted())},n}return Object(u.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){document.body.addEventListener("keydown",this.handleEscKey)}},{key:"componentWillUnmount",value:function(){document.body.removeEventListener("keydown",this.handleEscKey)}},{key:"render",value:function(){var e=this.props.showMenu?"flex":"none";return o.a.createElement("div",{className:"settings-wrapper",style:{display:e}},o.a.createElement("div",{className:"settings-content"},o.a.createElement("span",{className:"settings-close",onClick:this.props.handleModalClose,role:"img","aria-label":"close"},"\u274c"),o.a.createElement("h2",null,"Settings"),o.a.createElement("div",{className:"settings-section",onClick:this.handleDelete},o.a.createElement("button",{className:"btn-danger"},"Clear All Completed Todos")),o.a.createElement("div",{className:"settings-section",style:{display:"none"}},o.a.createElement("div",{className:"settings-header"},"Sort Todos:"),o.a.createElement("div",{className:"settings-options-wrapper","data-setting":"sortOrder"},o.a.createElement("div",{className:"settings-option",onClick:this.changeSetting,"data-value":"desc"},"Oldest First \u25bc"),o.a.createElement("div",{className:"settings-option",onClick:this.changeSetting,"data-value":"asc"},"Most Recent First \u25b2")))))}}]),t}(a.Component)),C=(n(27),function(e){var t=e.className||"";return o.a.createElement("span",{onClick:e.onClick,className:"setting-toggle-wrapper ".concat(t)},o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 125",className:"settings-toggle"},o.a.createElement("use",{xlinkHref:"#settings",className:"settings-gear"})))}),T={create:function(e){return fetch("/.netlify/functions/todos-create",{body:JSON.stringify(e),method:"POST"}).then(function(e){return e.json()})},readAll:function(){return fetch("/.netlify/functions/todos-read-all").then(function(e){return e.json()})},update:function(e,t){return fetch("/.netlify/functions/todos-update/".concat(e),{body:JSON.stringify(t),method:"POST"}).then(function(e){return e.json()})},delete:function(e){return fetch("/.netlify/functions/todos-delete/".concat(e),{method:"POST"}).then(function(e){return e.json()})},batchDelete:function(e){return fetch("/.netlify/functions/todos-delete-batch",{body:JSON.stringify({ids:e}),method:"POST"}).then(function(e){return e.json()})}};n(29);var S=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return(n=Object(i.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(o)))).state={todos:[],showMenu:!1},n.saveTodo=function(e){e.preventDefault();var t=n.state.todos,a=n.inputElement.value;if(!a)return alert("Please add Todo title"),n.inputElement.focus(),!1;n.inputElement.value="";var o={title:a,completed:!1},l=[{data:o,ts:1e4*(new Date).getTime()}].concat(t);n.setState({todos:l}),T.create(o).then(function(e){console.log(e);var a=O(t).concat(e);n.setState({todos:a})}).catch(function(e){console.log("An API error occurred",e);var a=O(t);n.setState({todos:a})})},n.deleteTodo=function(e){var t=n.state.todos,a=e.target.dataset.id,o=t.reduce(function(e,t){return j(t)===a?(e.rollbackTodo=t,e):(e.optimisticState=e.optimisticState.concat(t),e)},{rollbackTodo:{},optimisticState:[]});n.setState({todos:o.optimisticState}),T.delete(a).then(function(){console.log("deleted todo id ".concat(a))}).catch(function(e){console.log("There was an error removing ".concat(a),e),n.setState({todos:o.optimisticState.concat(o.rollbackTodo)})})},n.handleTodoCheckbox=function(e){var t=n.state.todos,a=e.target,o=a.checked,l=a.dataset.id,c=t.map(function(e,t){var n=e.data;return j(e)===l&&n.completed!==o&&(n.completed=o),e});n.setState({todos:c},function(){T.update(l,{completed:o}).then(function(){console.log("update todo ".concat(l),o)}).catch(function(e){console.log("An API error occurred",e)})})},n.updateTodoTitle=function(e,t){var a=!1,o=e.target.dataset.key,l=n.state.todos.map(function(e,n){return j(e)===o&&e.data.title!==t&&(e.data.title=t,a=!0),e});a&&n.setState({todos:l},function(){T.update(o,{title:t}).then(function(){console.log("update todo ".concat(o),t)}).catch(function(e){console.log("An API error occurred",e)})})},n.clearCompleted=function(){var e=n.state.todos.reduce(function(e,t){return t.data.completed?(e.completedTodoIds=e.completedTodoIds.concat(j(t)),e):(e.optimisticState=e.optimisticState.concat(t),e)},{completedTodoIds:[],optimisticState:[]});if(!e.completedTodoIds.length)return alert("Please check off some todos to batch remove them"),n.closeModal(),!1;n.setState({todos:e.optimisticState},function(){setTimeout(function(){n.closeModal()},600),T.batchDelete(e.completedTodoIds).then(function(){console.log("Batch removal complete",e.completedTodoIds)}).catch(function(e){console.log("An API error occurred",e)})})},n.closeModal=function(e){n.setState({showMenu:!1})},n.openModal=function(){n.setState({showMenu:!0})},n}return Object(u.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;T.readAll().then(function(t){if("unauthorized"===t.message)return!function(){var e="localhost"===window.location.hostname,t="[::1]"===window.location.hostname,n=window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/);return e||t||n}()?alert("FaunaDB key is not unauthorized. Verify the key `FAUNADB_SECRET` set in Netlify enviroment variables is correct"):alert("FaunaDB key is not unauthorized. Make sure you set it in terminal session where you ran `npm start`. Visit http://bit.ly/set-fauna-key for more info"),!1;console.log("all todos",t),e.setState({todos:t})})}},{key:"renderTodos",value:function(){var e=this,t=this.state.todos;if(!t||!t.length)return null;var n,a,l=(n="ts",a="desc",function(e,t){var o=new Date(e[n]).getTime(),l=new Date(t[n]).getTime();return"asc"===a?o-l:l-o});return t.sort(l).map(function(t,n){var a,l=t.data,c=t.ref,s=j(t);c&&(a=o.a.createElement("button",{"data-id":s,onClick:e.deleteTodo},"delete"));var r=l.completed?"#todo__box__done":"#todo__box";return o.a.createElement("div",{key:n,className:"todo-item"},o.a.createElement("label",{className:"todo"},o.a.createElement("input",{"data-id":s,className:"todo__state",type:"checkbox",onChange:e.handleTodoCheckbox,checked:l.completed}),o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 200 25",className:"todo__icon"},o.a.createElement("use",{xlinkHref:"".concat(r),className:"todo__box"}),o.a.createElement("use",{xlinkHref:"#todo__check",className:"todo__check"})),o.a.createElement("div",{className:"todo-list-title"},o.a.createElement(f,{tagName:"span",editKey:s,onBlur:e.updateTodoTitle,html:l.title}))),a)})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"app"},o.a.createElement(N,null),o.a.createElement("div",{className:"todo-list"},o.a.createElement("h2",null,"Create todo",o.a.createElement(C,{onClick:this.openModal,className:"mobile-toggle"})),o.a.createElement("form",{className:"todo-create-wrapper",onSubmit:this.saveTodo},o.a.createElement("input",{className:"todo-create-input",placeholder:"Add a todo item",name:"name",ref:function(t){return e.inputElement=t},autoComplete:"off",style:{marginRight:20}}),o.a.createElement("div",{className:"todo-actions"},o.a.createElement("button",{className:"todo-create-button"},"Create todo"),o.a.createElement(C,{onClick:this.openModal,className:"desktop-toggle"}))),this.renderTodos()),o.a.createElement(k,{showMenu:this.state.showMenu,handleModalClose:this.closeModal,handleClearCompleted:this.clearCompleted}))}}]),t}(a.Component);function O(e){return e.filter(function(e){return e.ref})}function j(e){return e.ref?e.ref["@ref"].id:null}c.a.render(o.a.createElement(S,null),document.getElementById("root"))}],[[13,2,1]]]);
//# sourceMappingURL=main.7c0eb763.chunk.js.map